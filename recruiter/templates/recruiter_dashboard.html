{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruiter Dashboard | Placemeet</title>

    <!-- Google font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Dashboard CSS -->
    <link rel="stylesheet" href="{% static 'recruiter-dashboard.css' %}">
</head>
<body>

<div class="recruiter-shell">
    <!-- Top header -->
    <header class="app-header">
        <button class="menu-toggle" type="button" onclick="toggleSidebar()">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <div class="header-logo">
            <img src="{% static 'logo2.png' %}" alt="Placemeet Logo" class="logo-img">
        </div>

        <div class="header-center">
            <span class="welcome-text">Welcome, {{ request.user.username }}</span>

        </div>

        <div class="header-right">
            <button class="btn btn-ghost" type="button"
                    onclick="window.location.href='{% url 'users:logout' %}'">
                Logout
            </button>
        </div>
    </header>

    <div class="recruiter-layout">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-title">Menu</div>
            <ul>
                <li class="active" data-target="overview" onclick="showSection(this)">
                    Dashboard Overview
                </li>
                <li data-target="search" onclick="showSection(this)">
                    Search Talent
                </li>
                <li data-target="applications" onclick="showSection(this)">
                    Applications &amp; Shortlist
                </li>
                <li data-target="final_list" onclick="showSection(this)">
                    Final List
                </li>
                <li data-target="job_requests" onclick="showSection(this)">
                    Your Job Requests
                </li>
                <li data-target="schedule" onclick="showSection(this)">
                    Schedule Interview
                </li>
            </ul>
        </aside>

        <!-- Main content -->
        <main class="recruiter-main">

            <!-- SECTION: Dashboard cards ONLY -->
            <section id="overview" class="section active">
                <div class="cards-grid">
                    <article class="card">
                        <h3>Candidates Eligible</h3>
                        <div class="big-number">
                            {{ eligible_count|default:0 }}
                        </div>
                        <p>Students currently meeting your job criteria.</p>
                    </article>

                    <article class="card">
                        <h3>Shortlisted</h3>
                        <div class="big-number">
                            {{ shortlisted_count|default:0 }}
                        </div>
                        <p>Candidates moved to shortlisted list.</p>
                    </article>

                    <article class="card">
                        <h3>Applications Received</h3>
                        <div class="big-number">
                            {{ applications_count|default:0 }}
                        </div>
                        <p>Total applications received for your openings.</p>
                    </article>
                </div>
            </section>

            <!-- SECTION: Search Talent -->
            <section id="search" class="section">
                <h2>Search Talent</h2>
                <form class="filter-form" method="get" action="">
                    <div class="form-row">
                        <div class="form-field">
                            <label for="branch">Branch</label>
                            <select id="branch" name="branch">
                                <option value="">Any</option>
                                <option value="CSE">CSE</option>
                                <option value="ECE">ECE</option>
                                <option value="EEE">EEE</option>
                                <option value="MECH">MECH</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label for="cgpa">Min CGPA</label>
                            <input type="number" step="0.1" min="0" max="10" id="cgpa" name="cgpa">
                        </div>
                        <div class="form-field">
                            <label for="skill_keyword">Skill keyword</label>
                            <input type="text" id="skill_keyword" name="skill_keyword"
                                   placeholder="e.g., Python, React">
                        </div>
                    </div>
                    <button class="btn btn-primary" type="submit">Search</button>
                </form>

                <div class="table-wrapper">
                    <table>
                        <thead>
                        <tr>
                            <th>Name</th>
                            <th>Branch</th>
                            <th>CGPA</th>
                            <th>Skills</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if search_results %}
                            {% for s in search_results %}
                                <tr>
                                    <td>{{ s.full_name }}</td>
                                    <td>{{ s.branch }}</td>
                                    <td>{{ s.cgpa }}</td>
                                    <td>{{ s.skills_summary }}</td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="4" class="empty-state">
                                    No students found for the current filters.
                                </td>
                            </tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- SECTION: Applications & Shortlist -->
            <section id="applications" class="section">
                <h2>Applications &amp; Shortlist</h2>
                <div class="table-wrapper">
                    <table>
                        <thead>
                        <tr>
                            <th>Student</th>
                            <th>Job</th>
                            <th>CGPA</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if applications %}
                            {% for app in applications %}
                                <tr>
                                    <td>{{ app.student.full_name }}</td>
                                    <td>{{ app.job.title }}</td>
                                    <td>{{ app.student.cgpa }}</td>
                                    <td>{{ app.status }}</td>
                                    <td>
                                        {% if app.status != 'shortlisted' %}
                                            <button class="btn btn-small"
                                                    type="button"
                                                    data-app-id="{{ app.id }}"
                                                    onclick="shortlistCandidate(this)">
                                                Mark Shortlisted
                                            </button>
                                        {% else %}
                                            <span class="badge badge-success">Shortlisted</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5" class="empty-state">
                                    No applications yet.
                                </td>
                            </tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- SECTION: Final List -->
            <section id="final_list" class="section">
                <h2>Final List</h2>
                <div class="table-wrapper">
                    <table>
                        <thead>
                        <tr>
                            <th>Student</th>
                            <th>Job</th>
                            <th>Branch</th>
                            <th>CGPA</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if final_list %}
                            {% for entry in final_list %}
                                <tr>
                                    <td>{{ entry.student.full_name }}</td>
                                    <td>{{ entry.job.title }}</td>
                                    <td>{{ entry.student.branch }}</td>
                                    <td>{{ entry.student.cgpa }}</td>
                                    <td>
                                        <button class="btn btn-small btn-ghost"
                                                type="button"
                                                data-final-id="{{ entry.id }}"
                                                onclick="removeFromFinal(this)">
                                            Remove
                                        </button>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5" class="empty-state">
                                    Final list is empty.
                                </td>
                            </tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- SECTION: Job Requests -->
            <section id="job_requests" class="section">
                <h2>Your Job Requests</h2>
                <div class="table-wrapper">
                    <table>
                        <thead>
                        <tr>
                            <th>Job</th>
                            <th>Branch</th>
                            <th>CGPA Cutoff</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if job_requests %}
                            {% for job in job_requests %}
                                <tr>
                                    <td>{{ job.title }}</td>
                                    <td>{{ job.branch }}</td>
                                    <td>{{ job.min_cgpa }}</td>
                                    <td>{{ job.status }}</td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="4" class="empty-state">
                                    No job requests yet.
                                </td>
                            </tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- SECTION: Schedule Interview -->
            <section id="schedule" class="section">
                <h2>Schedule Interview</h2>
                <form class="schedule-form" method="post" action="">
                    {% csrf_token %}
                    <div class="form-row">
                        <div class="form-field">
                            <label for="job_select">Job</label>
                            <select id="job_select" name="job">
                                {% for job in job_requests %}
                                    <option value="{{ job.id }}">{{ job.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-field">
                            <label for="date">Date</label>
                            <input type="date" id="date" name="date" required>
                        </div>
                        <div class="form-field">
                            <label for="time">Time</label>
                            <input type="time" id="time" name="time" required>
                        </div>
                    </div>
                    <div class="form-field">
                        <label for="notes">Notes for students</label>
                        <textarea id="notes" name="notes" rows="3"
                                  placeholder="e.g., Bring updated resume, dress code, etc."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Schedule Interview</button>
                </form>
            </section>

        </main>
    </div>
</div>

<!-- JS -->
<script src="{% static 'recruiter-dashboard.js' %}"></script>
</body>
</html>